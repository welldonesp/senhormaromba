{
  "version": 3,
  "sources": ["../../../../shared/redirect.js", "../../../src/render.js", "../../../src/index.js"],
  "sourceRoot": "/mnt/dados/YouTube/Senhor Maromba/site/senhormaromba-worker/senhormaromba/worker-loja/.wrangler/tmp/deploy-HVwUO6",
  "sourcesContent": ["// shared/redirect.js\n\nexport const BASE_REDIRECT = 'https://loja.senhormaromba.com.br/';\nconst ASSETS_BASE = 'https://welldonesp.github.io/senhormaromba/assets';\nconst PRODUTOS_URL = `${ASSETS_BASE}/produtos/_produtos.json`;\n\n// Normaliza nomes (remove espa\u00E7os e coloca em min\u00FAsculo)\nfunction normalize(str) {\n  return str.toLowerCase().replace(/\\s+/g, '');\n}\n\n// Exporta para uso externo em renderPage e index do worker\nexport function normalizeLoja(loja) {\n  return normalize(loja);\n}\n\n// Busca produtos do JSON\nexport async function getProdutos() {\n  const res = await fetch(PRODUTOS_URL);\n  if (!res.ok) throw new Error('N\u00E3o foi poss\u00EDvel carregar os produtos');\n  return res.json();\n}\n\n// Retorna a URL real da loja (para redirecionamento efetivo)\nexport async function redirectReal(produto, loja) {\n  const produtos = await getProdutos();\n\n  for (const secao of Object.values(produtos)) {\n    if (secao[produto]) {\n      const item = secao[produto];\n      let lojaEscolhida;\n\n      if (loja) {\n        lojaEscolhida = item.lojas.find(l => normalize(l.loja) === normalize(loja));\n      }\n\n      if (!lojaEscolhida) lojaEscolhida = item.lojas[0];\n\n      return lojaEscolhida.url;\n    }\n  }\n\n  return null;\n}\n\n// Retorna a URL interna de redirecionamento (do worker)\nexport function redirect(produto, loja) {\n  const lojaNorm = normalize(loja);\n  return `${BASE_REDIRECT}${produto}/${lojaNorm}`;\n}\n", "const BASE = 'https://welldonesp.github.io/senhormaromba/';\nconst ASSETS_BASE = BASE + 'assets';\nconst CSS_BASE = BASE + 'worker-loja/src/';\nconst PRODUTOS_URL = `${ASSETS_BASE}/produtos/_produtos.json`;\n\nimport { redirect, normalizeLoja, getProdutos } from '../../shared/redirect.js';\n\nfunction capitalizeWords(str) {\n  return str\n    .split('-')\n    .map(word => word.charAt(0).toUpperCase() + word.slice(1))\n    .join(' ');\n}\n\nfunction lojaIcon(loja) {\n  return `${ASSETS_BASE}/lojas/${normalizeLoja(loja)}.png`;\n}\n\nfunction stripHTML(str) {\n  return str ? str.replace(/<[^>]*>?/gm, '') : '';\n}\n\nexport async function renderPage() {\n  const produtos = await getProdutos();\n\n  let html = `\n    <!DOCTYPE html>\n    <html lang=\"pt-BR\">\n    <head>\n      <meta charset=\"UTF-8\">\n      <meta http-equiv=\"Strict-Transport-Security\" content=\"max-age=31536000; includeSubDomains; preload\">\n      <meta name=\"description\" content=\"Pare de gastar com produtos ruins! Loja Senhor Maromba tem tudo para muscula\u00E7\u00E3o testado de verdade. Compre agora!\">\n      <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n      <title>Loja Senhor Maromba</title>\n\n      <!-- FAVICONS -->\n      <link rel=\"icon\" href=\"/favicon.ico\" sizes=\"any\">\n      <link rel=\"icon\" type=\"image/png\" sizes=\"32x32\" href=\"/favicon-32x32.png\">\n      <link rel=\"icon\" type=\"image/png\" sizes=\"192x192\" href=\"/favicon-192x192.png\">\n      <link rel=\"apple-touch-icon\" sizes=\"180x180\" href=\"/apple-touch-icon.png\">\n      <link rel=\"stylesheet\" href=\"${CSS_BASE}style.css?v=16\">\n\n      <!-- Google tag (gtag.js) -->\n      <script async src=\"https://www.googletagmanager.com/gtag/js?id=G-20QTN1YSP8\"></script>\n      <script>\n        window.dataLayer = window.dataLayer || [];\n        function gtag(){dataLayer.push(arguments);}\n        gtag('js', new Date());\n        gtag('config', 'G-20QTN1YSP8');\n      </script>      \n\n      </head>\n    <body>\n      <div class=\"header\">\n        <img src=\"${ASSETS_BASE}/logotipo.png\" alt=\"Logotipo Senhor Maromba\" class=\"logo\">\n        <h1>Loja Senhor Maromba \uD83D\uDD25</h1>\n      </div>\n      Produtos para quem treina s\u00E9rio. \uD83D\uDCAA\n  `;\n\n  for (const [secaoNome, secaoProdutos] of Object.entries(produtos)) {\n    const produtosAtivos = Object.values(secaoProdutos).filter(produtoDados =>\n      produtoDados.lojas.some(l => l.status === \"0\" || l.status === \"1\")\n    );\n    if (produtosAtivos.length === 0) continue;\n\n    html += `<h2 class=\"secao\">${secaoNome}</h2>`;\n\n    for (const [produtoNome, produtoDados] of Object.entries(secaoProdutos)) {\n      const lojasAtivas = produtoDados.lojas.filter(l => l.status === \"0\" || l.status === \"1\");\n      if (lojasAtivas.length === 0) continue;\n\n      // usa tit se existir, sen\u00E3o fallback para nomeFormatado\n      const nomeFormatado = capitalizeWords(produtoNome.replace(/-/g, \" \"));\n      const titulo = produtoDados.tit || nomeFormatado;\n      const descricao = produtoDados.desc || '';\n      const descricaoAlt = stripHTML(descricao);\n\n      html += `\n        <div class=\"produto\">\n          <div class=\"produto-container\">\n            <div class=\"produto-info\">\n              <div class=\"produto-header\">\n                <h3>${titulo}</h3>\n              </div>\n\n              <div class=\"produto-body\">\n                <img class=\"produto-img\"\n                    src=\"${ASSETS_BASE}/produtos/${produtoNome}.webp\"\n                    data-src-webp=\"${ASSETS_BASE}/produtos/${produtoNome}.webp\"\n                    data-src-png=\"${ASSETS_BASE}/produtos/${produtoNome}.png\"\n                    data-src-jpg=\"${ASSETS_BASE}/produtos/${produtoNome}.jpg\"\n                    data-fallback-step=\"0\"\n                    alt=\"${titulo} - ${descricaoAlt} | Loja Senhor Maromba\"\n                    title=\"${titulo} para muscula\u00E7\u00E3o - Loja Senhor Maromba\"\n                    onclick=\"openModal(this)\"\n                    onerror=\"fallbackImg(this)\">\n\n                <p class=\"produto-desc\">${descricao}</p>\n              </div>\n\n              <div class=\"links\">\n      `;\n\n      for (const l of lojasAtivas) {\n        const lojaHref = redirect(produtoNome, l.loja);\n\n        html += `\n          <a class=\"loja-link\" \n            href=\"${lojaHref}\" \n            target=\"_blank\"\n            onclick=\"gtag('event', 'click', {\n                event_category: 'loja',\n                event_label: '${l.loja}',\n                value: 1\n            });\">\n            <img src=\"${lojaIcon(l.loja)}\" alt=\"${titulo} em ${l.loja}\">${l.loja}\n          </a>\n        `;\n      }\n\n      html += `</div></div></div></div>`;\n    }\n  }\n\n  html += `\n    <div id=\"imgModal\" class=\"modal\" aria-hidden=\"true\">\n      <span class=\"modal-close\" onclick=\"closeModal()\" role=\"button\" aria-label=\"Fechar\">&times;</span>\n      <img class=\"modal-content\" id=\"modalImg\" alt=\"\">\n    </div>\n\n    <footer>\n      Conhe\u00E7a o canal: <a href=\"https://www.youtube.com/@SenhorMaromba\" target=\"_blank\">Senhor Maromba</a><br>\n      <br>\n      Todos os links s\u00E3o afiliados.<br>\n      Sua compra apoia meu conte\u00FAdo! \uD83D\uDE4C<br>\n    </footer>\n\n    <script>\n      function fallbackImg(img) {\n        const step = parseInt(img.dataset.fallbackStep || '0', 10);\n\n        if (step === 0 && img.dataset.srcPng) {\n          img.dataset.fallbackStep = '1';\n          img.src = img.dataset.srcPng;\n          return;\n        }\n\n        if (step === 1 && img.dataset.srcJpg) {\n          img.dataset.fallbackStep = '2';\n          img.src = img.dataset.srcJpg;\n          return;\n        }\n\n        img.onerror = null;\n        img.src = '${ASSETS_BASE}/produtos/placeholder.png';\n      }\n\n      function openModal(elOrSrc) {\n        const modal = document.getElementById('imgModal');\n        const modalImg = document.getElementById('modalImg');\n        let src;\n        if (!elOrSrc) return;\n        if (typeof elOrSrc === 'string') {\n          src = elOrSrc;\n        } else {\n          src = elOrSrc.currentSrc || elOrSrc.src;\n        }\n        modalImg.src = src;\n        modalImg.alt = '';\n        modal.style.display = 'block';\n        modal.setAttribute('aria-hidden', 'false');\n      }\n\n      function closeModal() {\n        const modal = document.getElementById('imgModal');\n        const modalImg = document.getElementById('modalImg');\n        modal.style.display = 'none';\n        modal.setAttribute('aria-hidden', 'true');\n        modalImg.src = '';\n      }\n\n      window.addEventListener('click', function(event) {\n        const modal = document.getElementById('imgModal');\n        if (event.target === modal) closeModal();\n      });\n\n      window.addEventListener('keydown', function(e) {\n        if (e.key === 'Escape') closeModal();\n      });\n    </script>\n    </body>\n    </html>\n  `;\n\n  return html;\n}\n", "import { redirectReal } from '../../shared/redirect.js';\nimport { renderPage } from './render.js';\n\nconst _BASE = 'https://welldonesp.github.io/senhormaromba';\nconst LOJA_URL = 'https://loja.senhormaromba.com.br/';\n\nexport default {\n  async fetch(request) {\n    const url = new URL(request.url);\n    const parts = url.pathname.split(\"/\").filter(p => p);\n    const produto = parts[0];\n    const loja = parts[1];\n\n    // Endpoint para sitemap.xml\n    if (url.pathname === '/sitemap.xml') {\n      try {\n        const sitemapRes = await fetch(`${_BASE}/sitemap.xml`);\n        if (!sitemapRes.ok) {\n          return new Response('Erro ao carregar sitemap', { status: 500 });\n        }\n        const sitemap = await sitemapRes.text();\n        return new Response(sitemap, {\n          headers: { 'Content-Type': 'application/xml; charset=UTF-8' },\n        });\n      } catch (err) {\n        return new Response('Erro interno ao servir sitemap', { status: 500 });\n      }\n    }\n\n    // Endpoint para robots.txt\n    if (url.pathname === '/robots.txt') {\n        return Response.redirect(`${_BASE}/robots.txt`, 301);\n    }\n\n    // Aliases para \u00EDcones na raiz\n    const aliases = {\n      '/favicon.ico': '/assets/favicon.ico',\n      '/favicon-16x16.png': '/assets/favicon-16x16.png',\n      '/favicon-32x32.png': '/assets/favicon-32x32.png',\n      '/apple-touch-icon.png': '/assets/apple-touch-icon.png',\n      '/android-chrome-192x192.png': '/assets/android-chrome-192x192.png',\n      '/android-chrome-512x512.png': '/assets/android-chrome-512x512.png',\n      '/logotipo.png': '/assets/logotipo.png'\n    };\n\n    if (aliases[url.pathname]) {\n      const assetRes = await fetch(`${_BASE}${aliases[url.pathname]}`);\n      if (!assetRes.ok) {\n        return new Response('Erro ao carregar asset', { status: 404 });\n      }\n      let contentType = 'application/octet-stream';\n      if (url.pathname.endsWith('.png')) contentType = 'image/png';\n      if (url.pathname.endsWith('.ico')) contentType = 'image/x-icon';\n      return new Response(await assetRes.arrayBuffer(), {\n        headers: { 'Content-Type': contentType }\n      });\n    }\n\n    // P\u00E1gina principal da loja\n    if (!produto) {\n      const html = await renderPage();\n      return new Response(html, {\n        headers: {\n          'Content-Type': 'text/html; charset=UTF-8',\n          'Strict-Transport-Security': 'max-age=31536000; includeSubDomains; preload'\n        }\n      });\n    }\n\n    // Redirecionamento real para o produto\n    const destino = await redirectReal(produto, loja); // <- ass\u00EDncrono\n    if (!destino) {\n      // Se o produto n\u00E3o existir, redireciona para a loja (301)\n      return new Response(null, {\n        status: 301,\n        headers: {\n          'Location': LOJA_URL,\n          'Cache-Control': 'no-store, no-cache, must-revalidate, proxy-revalidate'\n        }\n      });\n    }\n\n    return new Response(null, {\n      status: 301,\n      headers: {\n        'Location': destino,\n        'Cache-Control': 'no-store, no-cache, must-revalidate, proxy-revalidate'\n      }\n    });\n  }\n};\n"],
  "mappings": "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",
  "names": ["ASSETS_BASE", "PRODUTOS_URL"]
}
